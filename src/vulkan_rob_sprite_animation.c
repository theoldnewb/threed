#include "app.h"
#include "vulkan.h"
#include "defines.h"
#include "debug.h"
#include "check.h"


#include <cglm/vec2.h>
#include <cglm/vec3.h>
#include <cglm/mat4.h>
#include <cglm/affine.h>
#include <cglm/cam.h>

#include <SDL3/SDL_stdinc.h>


#define max_vulkan_descriptor_set_layout_binding        4
#define max_vulkan_descriptor_pool_size                 4
#define max_vulkan_pipeline_shader_stage_create_infos   2
#define max_vulkan_vertex_input_attribute_descriptions  3
#define max_vulkan_dynamic_states                       2
#define max_vulkan_descriptor_buffer_infos              1
#define max_vulkan_descriptor_image_infos               1
#define max_vulkan_write_descriptor_sets                2


typedef struct vulkan_rob
{
    VkDescriptorSetLayoutBinding    descriptor_set_layout_bindings_[max_vulkan_descriptor_set_layout_binding] ;
    uint32_t                        descriptor_set_layout_bindings_count_ ;
    VkDescriptorSetLayout           descriptor_set_layout_ ;
    VkDescriptorSet                 descriptor_sets_[max_vulkan_frames_in_flight] ;

    VkDescriptorBufferInfo          descriptor_buffer_infos_[max_vulkan_frames_in_flight * max_vulkan_descriptor_buffer_infos] ;
    uint32_t                        descriptor_buffer_infos_count_ ;
    VkDescriptorImageInfo           descriptor_image_infos_[max_vulkan_frames_in_flight * max_vulkan_descriptor_image_infos] ;
    uint32_t                        descriptor_image_infos_count_ ;
    VkWriteDescriptorSet            write_descriptor_sets_[max_vulkan_frames_in_flight * max_vulkan_write_descriptor_sets] ;
    uint32_t                        write_descriptor_sets_count_ ;

    VkDescriptorPoolSize            descriptor_pool_sizes_[max_vulkan_descriptor_pool_size] ;
    uint32_t                        descriptor_pool_sizes_count_ ;
    VkDescriptorPool                descriptor_pool_ ;

    VkBuffer        uniform_buffers_[max_vulkan_frames_in_flight] ;
    VkDeviceMemory  uniform_buffers_memory_[max_vulkan_frames_in_flight] ;
    void *          uniform_buffers_mapped_[max_vulkan_frames_in_flight] ;

    VkPipelineLayoutCreateInfo      pipeline_layout_create_info_ ;
    VkPipelineLayout                pipeline_layout_ ;
    VkPipeline                      graphics_pipeline_ ;

    VkDescriptorSetLayoutCreateInfo descriptor_set_layout_create_info_ ;

    uint32_t            texture_mip_levels_ ;
    VkImage             texture_image_ ;
    VkDeviceMemory      texture_image_memory_ ;
    VkImageView         texture_image_view_ ;
    VkSampler           texture_sampler_ ;
    VkBool32            texture_enable_anisotropy_ ;
    float               texture_anisotropy_ ;

    VkBuffer        vertex_buffer_ ;
    VkDeviceMemory  vertex_buffer_memory_ ;
    VkBuffer        index_buffer_ ;
    VkDeviceMemory  index_buffer_memory_ ;

    VkShaderModule  vert_shader_ ;
    VkShaderModule  frag_shader_ ;


    VkPipelineShaderStageCreateInfo pipeline_shader_stage_create_infos_[max_vulkan_pipeline_shader_stage_create_infos] ;
    uint32_t                        pipeline_shader_stage_create_infos_count_ ;

    VkVertexInputBindingDescription vertex_input_binding_description_ ;

    VkVertexInputAttributeDescription   vertex_input_attribute_descriptions_[max_vulkan_vertex_input_attribute_descriptions] ;
    uint32_t                            vertex_input_attribute_descriptions_count_ ;

    VkPipelineVertexInputStateCreateInfo    pipeline_vertex_input_state_create_info_ ;
    VkPipelineInputAssemblyStateCreateInfo  pipeline_input_assembly_state_create_info_ ;
    VkPipelineViewportStateCreateInfo       pipeline_viewport_state_create_info_ ;
    VkPipelineDynamicStateCreateInfo        pipeline_dynamic_state_create_info_ ;
    VkPipelineRasterizationStateCreateInfo  pipeline_rasterization_state_create_info_ ;
    VkPipelineMultisampleStateCreateInfo    pipeline_multisample_state_create_info_ ;
    VkPipelineColorBlendAttachmentState     pipeline_color_blend_attachment_state_ ;
    VkPipelineColorBlendStateCreateInfo     pipeline_color_blend_state_create_info_ ;
    VkPipelineDepthStencilStateCreateInfo   pipeline_depth_stencil_state_create_info_ ;
    VkGraphicsPipelineCreateInfo            graphics_pipeline_create_info_ ;

    VkViewport  viewport_ ;
    VkRect2D    scissor_ ;

    VkDynamicState  dynamic_states_[max_vulkan_dynamic_states] ;
    uint32_t        dynamic_states_count_ ;

} vulkan_rob ;


static vulkan_rob   the_vulkan_rob_ = { 0 } ;


//////////////////////////////////////7

typedef struct vertex {
    vec2 pos ;
    vec2 uv ;
} vertex ;

static uint32_t const vertex_size = sizeof(vertex) ;




static mat4 const frames[] =
{
  {
    { 21.000000, 3.000000, 0.730469, 0.280273 }
  , { 203.000000, 3.000000, 0.819336, 0.280273 }
  , { 203.000000, 157.000000, 0.819336, 0.355469 }
  , { 21.000000, 157.000000, 0.730469, 0.355469 }
  }
, {
    { 18.000000, 3.000000, 0.640625, 0.289551 }
  , { 200.000000, 3.000000, 0.729492, 0.289551 }
  , { 200.000000, 157.000000, 0.729492, 0.364746 }
  , { 18.000000, 157.000000, 0.640625, 0.364746 }
  }
, {
    { 15.000000, 3.000000, 0.459961, 0.289062 }
  , { 197.000000, 3.000000, 0.548828, 0.289062 }
  , { 197.000000, 157.000000, 0.548828, 0.364258 }
  , { 15.000000, 157.000000, 0.459961, 0.364258 }
  }
, {
    { 13.000000, 3.000000, 0.549316, 0.359375 }
  , { 194.000000, 3.000000, 0.637695, 0.359375 }
  , { 194.000000, 157.000000, 0.637695, 0.434570 }
  , { 13.000000, 157.000000, 0.549316, 0.434570 }
  }
, {
    { 11.000000, 3.000000, 0.907715, 0.434570 }
  , { 191.000000, 3.000000, 0.995605, 0.434570 }
  , { 191.000000, 157.000000, 0.995605, 0.509766 }
  , { 11.000000, 157.000000, 0.907715, 0.509766 }
  }
, {
    { 8.000000, 3.000000, 0.815918, 0.440918 }
  , { 188.000000, 3.000000, 0.903809, 0.440918 }
  , { 188.000000, 157.000000, 0.903809, 0.516113 }
  , { 8.000000, 157.000000, 0.815918, 0.516113 }
  }
, {
    { 7.000000, 3.000000, 0.819824, 0.289551 }
  , { 188.000000, 3.000000, 0.908203, 0.289551 }
  , { 188.000000, 157.000000, 0.908203, 0.364746 }
  , { 7.000000, 157.000000, 0.819824, 0.364746 }
  }
, {
    { 5.000000, 3.000000, 0.273926, 0.289062 }
  , { 188.000000, 3.000000, 0.363281, 0.289062 }
  , { 188.000000, 157.000000, 0.363281, 0.364258 }
  , { 5.000000, 157.000000, 0.273926, 0.364258 }
  }
, {
    { 3.000000, 3.000000, 0.000488, 0.283691 }
  , { 189.000000, 3.000000, 0.091309, 0.283691 }
  , { 189.000000, 157.000000, 0.091309, 0.358887 }
  , { 3.000000, 157.000000, 0.000488, 0.358887 }
  }
, {
    { 2.000000, 3.000000, 0.468262, 0.138672 }
  , { 189.000000, 3.000000, 0.559570, 0.138672 }
  , { 189.000000, 156.000000, 0.559570, 0.213379 }
  , { 2.000000, 156.000000, 0.468262, 0.213379 }
  }
, {
    { 1.000000, 3.000000, 0.283691, 0.138672 }
  , { 189.000000, 3.000000, 0.375488, 0.138672 }
  , { 189.000000, 156.000000, 0.375488, 0.213379 }
  , { 1.000000, 156.000000, 0.283691, 0.213379 }
  }
, {
    { 1.000000, 3.000000, 0.560059, 0.138672 }
  , { 188.000000, 3.000000, 0.651367, 0.138672 }
  , { 188.000000, 156.000000, 0.651367, 0.213379 }
  , { 1.000000, 156.000000, 0.560059, 0.213379 }
  }
, {
    { 0.000000, 2.000000, 0.000488, 0.208008 }
  , { 188.000000, 2.000000, 0.092285, 0.208008 }
  , { 188.000000, 156.000000, 0.092285, 0.283203 }
  , { 0.000000, 156.000000, 0.000488, 0.283203 }
  }
, {
    { 0.000000, 2.000000, 0.651855, 0.138672 }
  , { 187.000000, 2.000000, 0.743164, 0.138672 }
  , { 187.000000, 156.000000, 0.743164, 0.213867 }
  , { 0.000000, 156.000000, 0.651855, 0.213867 }
  }
, {
    { 0.000000, 2.000000, 0.821777, 0.139160 }
  , { 187.000000, 2.000000, 0.913086, 0.139160 }
  , { 187.000000, 155.000000, 0.913086, 0.213867 }
  , { 0.000000, 155.000000, 0.821777, 0.213867 }
  }
, {
    { 1.000000, 2.000000, 0.183105, 0.283691 }
  , { 186.000000, 2.000000, 0.273438, 0.283691 }
  , { 186.000000, 155.000000, 0.273438, 0.358398 }
  , { 1.000000, 155.000000, 0.183105, 0.358398 }
  }
, {
    { 2.000000, 2.000000, 0.183105, 0.358887 }
  , { 185.000000, 2.000000, 0.272461, 0.358887 }
  , { 185.000000, 155.000000, 0.272461, 0.433594 }
  , { 2.000000, 155.000000, 0.183105, 0.433594 }
  }
, {
    { 3.000000, 2.000000, 0.729980, 0.355957 }
  , { 184.000000, 2.000000, 0.818359, 0.355957 }
  , { 184.000000, 155.000000, 0.818359, 0.430664 }
  , { 3.000000, 155.000000, 0.729980, 0.430664 }
  }
, {
    { 5.000000, 2.000000, 0.913086, 0.284668 }
  , { 183.000000, 2.000000, 1.000000, 0.284668 }
  , { 183.000000, 154.000000, 1.000000, 0.358887 }
  , { 5.000000, 154.000000, 0.913086, 0.358887 }
  }
, {
    { 7.000000, 2.000000, 0.452148, 0.364746 }
  , { 181.000000, 2.000000, 0.537109, 0.364746 }
  , { 181.000000, 154.000000, 0.537109, 0.438965 }
  , { 7.000000, 154.000000, 0.452148, 0.438965 }
  }
, {
    { 9.000000, 1.000000, 0.537598, 0.435059 }
  , { 181.000000, 1.000000, 0.621582, 0.435059 }
  , { 181.000000, 154.000000, 0.621582, 0.509766 }
  , { 9.000000, 154.000000, 0.537598, 0.509766 }
  }
, {
    { 12.000000, 1.000000, 0.000488, 0.359375 }
  , { 180.000000, 1.000000, 0.082520, 0.359375 }
  , { 180.000000, 153.000000, 0.082520, 0.433594 }
  , { 12.000000, 153.000000, 0.000488, 0.433594 }
  }
, {
    { 15.000000, 1.000000, 0.000488, 0.434082 }
  , { 180.000000, 1.000000, 0.081055, 0.434082 }
  , { 180.000000, 153.000000, 0.081055, 0.508301 }
  , { 15.000000, 153.000000, 0.000488, 0.508301 }
  }
, {
    { 19.000000, 1.000000, 0.563965, 0.516113 }
  , { 179.000000, 1.000000, 0.642090, 0.516113 }
  , { 179.000000, 153.000000, 0.642090, 0.590332 }
  , { 19.000000, 153.000000, 0.563965, 0.590332 }
  }
, {
    { 23.000000, 1.000000, 0.706543, 0.650879 }
  , { 178.000000, 1.000000, 0.782227, 0.650879 }
  , { 178.000000, 152.000000, 0.782227, 0.724609 }
  , { 23.000000, 152.000000, 0.706543, 0.724609 }
  }
, {
    { 27.000000, 1.000000, 0.081543, 0.504395 }
  , { 178.000000, 1.000000, 0.155273, 0.504395 }
  , { 178.000000, 152.000000, 0.155273, 0.578125 }
  , { 27.000000, 152.000000, 0.081543, 0.578125 }
  }
, {
    { 32.000000, 1.000000, 0.074219, 0.578613 }
  , { 177.000000, 1.000000, 0.145020, 0.578613 }
  , { 177.000000, 151.000000, 0.145020, 0.651855 }
  , { 32.000000, 151.000000, 0.074219, 0.651855 }
  }
, {
    { 37.000000, 1.000000, 0.369629, 0.514160 }
  , { 175.000000, 1.000000, 0.437012, 0.514160 }
  , { 175.000000, 151.000000, 0.437012, 0.587402 }
  , { 37.000000, 151.000000, 0.369629, 0.587402 }
  }
, {
    { 43.000000, 0.000000, 0.362793, 0.587891 }
  , { 177.000000, 0.000000, 0.428223, 0.587891 }
  , { 177.000000, 151.000000, 0.428223, 0.661621 }
  , { 43.000000, 151.000000, 0.362793, 0.661621 }
  }
, {
    { 49.000000, 0.000000, 0.362305, 0.662109 }
  , { 178.000000, 0.000000, 0.425293, 0.662109 }
  , { 178.000000, 150.000000, 0.425293, 0.735352 }
  , { 49.000000, 150.000000, 0.362305, 0.735352 }
  }
, {
    { 52.000000, 0.000000, 0.552734, 0.735840 }
  , { 179.000000, 0.000000, 0.614746, 0.735840 }
  , { 179.000000, 150.000000, 0.614746, 0.809082 }
  , { 52.000000, 150.000000, 0.552734, 0.809082 }
  }
, {
    { 52.000000, 0.000000, 0.761719, 0.732910 }
  , { 179.000000, 0.000000, 0.823730, 0.732910 }
  , { 179.000000, 149.000000, 0.823730, 0.805664 }
  , { 52.000000, 149.000000, 0.761719, 0.805664 }
  }
, {
    { 52.000000, 0.000000, 0.698730, 0.725098 }
  , { 180.000000, 0.000000, 0.761230, 0.725098 }
  , { 180.000000, 149.000000, 0.761230, 0.797852 }
  , { 52.000000, 149.000000, 0.698730, 0.797852 }
  }
, {
    { 52.000000, 0.000000, 0.493164, 0.662598 }
  , { 181.000000, 0.000000, 0.556152, 0.662598 }
  , { 181.000000, 148.000000, 0.556152, 0.734863 }
  , { 52.000000, 148.000000, 0.493164, 0.734863 }
  }
, {
    { 52.000000, 0.000000, 0.425781, 0.727051 }
  , { 181.000000, 0.000000, 0.488770, 0.727051 }
  , { 181.000000, 148.000000, 0.488770, 0.799316 }
  , { 52.000000, 148.000000, 0.425781, 0.799316 }
  }
, {
    { 52.000000, 0.000000, 0.642578, 0.516113 }
  , { 182.000000, 0.000000, 0.706055, 0.516113 }
  , { 182.000000, 147.000000, 0.706055, 0.587891 }
  , { 52.000000, 147.000000, 0.642578, 0.587891 }
  }
, {
    { 52.000000, 0.000000, 0.634277, 0.660645 }
  , { 183.000000, 0.000000, 0.698242, 0.660645 }
  , { 183.000000, 147.000000, 0.698242, 0.732422 }
  , { 52.000000, 147.000000, 0.634277, 0.732422 }
  }
, {
    { 52.000000, 0.000000, 0.503906, 0.590820 }
  , { 185.000000, 0.000000, 0.568848, 0.590820 }
  , { 185.000000, 146.000000, 0.568848, 0.662109 }
  , { 52.000000, 146.000000, 0.503906, 0.662109 }
  }
, {
    { 51.000000, 0.000000, 0.296387, 0.577148 }
  , { 186.000000, 0.000000, 0.362305, 0.577148 }
  , { 186.000000, 146.000000, 0.362305, 0.648438 }
  , { 51.000000, 146.000000, 0.296387, 0.648438 }
  }
, {
    { 47.000000, 0.000000, 0.300781, 0.505371 }
  , { 187.000000, 0.000000, 0.369141, 0.505371 }
  , { 187.000000, 146.000000, 0.369141, 0.576660 }
  , { 47.000000, 146.000000, 0.300781, 0.576660 }
  }
, {
    { 43.000000, 0.000000, 0.000488, 0.580078 }
  , { 187.000000, 0.000000, 0.070801, 0.580078 }
  , { 187.000000, 145.000000, 0.070801, 0.650879 }
  , { 43.000000, 145.000000, 0.000488, 0.650879 }
  }
, {
    { 40.000000, 0.000000, 0.155762, 0.504395 }
  , { 188.000000, 0.000000, 0.228027, 0.504395 }
  , { 188.000000, 145.000000, 0.228027, 0.575195 }
  , { 40.000000, 145.000000, 0.155762, 0.575195 }
  }
, {
    { 36.000000, 0.000000, 0.782715, 0.662109 }
  , { 188.000000, 0.000000, 0.856934, 0.662109 }
  , { 188.000000, 144.000000, 0.856934, 0.732422 }
  , { 36.000000, 144.000000, 0.782715, 0.732422 }
  }
, {
    { 33.000000, 0.000000, 0.783691, 0.591309 }
  , { 189.000000, 0.000000, 0.859863, 0.591309 }
  , { 189.000000, 144.000000, 0.859863, 0.661621 }
  , { 33.000000, 144.000000, 0.783691, 0.661621 }
  }
, {
    { 30.000000, 0.000000, 0.743652, 0.138672 }
  , { 189.000000, 0.000000, 0.821289, 0.138672 }
  , { 189.000000, 144.000000, 0.821289, 0.208984 }
  , { 30.000000, 144.000000, 0.743652, 0.208984 }
  }
, {
    { 27.000000, 0.000000, 0.325684, 0.435059 }
  , { 189.000000, 0.000000, 0.404785, 0.435059 }
  , { 189.000000, 143.000000, 0.404785, 0.504883 }
  , { 27.000000, 143.000000, 0.325684, 0.504883 }
  }
, {
    { 24.000000, 0.000000, 0.164551, 0.434082 }
  , { 188.000000, 0.000000, 0.244629, 0.434082 }
  , { 188.000000, 143.000000, 0.244629, 0.503906 }
  , { 24.000000, 143.000000, 0.164551, 0.503906 }
  }
, {
    { 21.000000, 0.000000, 0.083008, 0.359375 }
  , { 188.000000, 0.000000, 0.164551, 0.359375 }
  , { 188.000000, 143.000000, 0.164551, 0.429199 }
  , { 21.000000, 143.000000, 0.083008, 0.429199 }
  }
, {
    { 18.000000, 0.000000, 0.706543, 0.506836 }
  , { 189.000000, 0.000000, 0.790039, 0.506836 }
  , { 189.000000, 142.000000, 0.790039, 0.576172 }
  , { 18.000000, 142.000000, 0.706543, 0.576172 }
  }
, {
    { 15.000000, 0.000000, 0.272949, 0.364746 }
  , { 194.000000, 0.000000, 0.360352, 0.364746 }
  , { 194.000000, 142.000000, 0.360352, 0.434082 }
  , { 15.000000, 142.000000, 0.272949, 0.434082 }
  }
, {
    { 13.000000, 0.000000, 0.369141, 0.213867 }
  , { 198.000000, 0.000000, 0.459473, 0.213867 }
  , { 198.000000, 142.000000, 0.459473, 0.283203 }
  , { 13.000000, 142.000000, 0.369141, 0.283203 }
  }
, {
    { 11.000000, 0.000000, 0.096680, 0.138672 }
  , { 202.000000, 0.000000, 0.189941, 0.138672 }
  , { 202.000000, 141.000000, 0.189941, 0.207520 }
  , { 11.000000, 141.000000, 0.096680, 0.207520 }
  }
, {
    { 8.000000, 0.000000, 0.821777, 0.069824 }
  , { 206.000000, 0.000000, 0.918457, 0.069824 }
  , { 206.000000, 141.000000, 0.918457, 0.138672 }
  , { 8.000000, 141.000000, 0.821777, 0.138672 }
  }
, {
    { 7.000000, 0.000000, 0.623047, 0.069336 }
  , { 210.000000, 0.000000, 0.722168, 0.069336 }
  , { 210.000000, 141.000000, 0.722168, 0.138184 }
  , { 7.000000, 141.000000, 0.623047, 0.138184 }
  }
, {
    { 5.000000, 0.000000, 0.419434, 0.069336 }
  , { 213.000000, 0.000000, 0.520996, 0.069336 }
  , { 213.000000, 141.000000, 0.520996, 0.138184 }
  , { 5.000000, 141.000000, 0.419434, 0.138184 }
  }
, {
    { 3.000000, 0.000000, 0.211426, 0.069336 }
  , { 216.000000, 0.000000, 0.315430, 0.069336 }
  , { 216.000000, 141.000000, 0.315430, 0.138184 }
  , { 3.000000, 141.000000, 0.211426, 0.138184 }
  }
, {
    { 2.000000, 0.000000, 0.000488, 0.069336 }
  , { 218.000000, 0.000000, 0.105957, 0.069336 }
  , { 218.000000, 141.000000, 0.105957, 0.138184 }
  , { 2.000000, 141.000000, 0.000488, 0.138184 }
  }
, {
    { 1.000000, 0.000000, 0.762695, 0.000488 }
  , { 220.000000, 0.000000, 0.869629, 0.000488 }
  , { 220.000000, 140.000000, 0.869629, 0.068848 }
  , { 1.000000, 140.000000, 0.762695, 0.068848 }
  }
, {
    { 1.000000, 0.000000, 0.546875, 0.000488 }
  , { 221.000000, 0.000000, 0.654297, 0.000488 }
  , { 221.000000, 140.000000, 0.654297, 0.068848 }
  , { 1.000000, 140.000000, 0.546875, 0.068848 }
  }
, {
    { 0.000000, 0.000000, 0.329102, 0.000488 }
  , { 222.000000, 0.000000, 0.437500, 0.000488 }
  , { 222.000000, 140.000000, 0.437500, 0.068848 }
  , { 0.000000, 140.000000, 0.329102, 0.068848 }
  }
, {
    { 0.000000, 0.000000, 0.110352, 0.000488 }
  , { 223.000000, 0.000000, 0.219238, 0.000488 }
  , { 223.000000, 140.000000, 0.219238, 0.068848 }
  , { 0.000000, 140.000000, 0.110352, 0.068848 }
  }
, {
    { 0.000000, 0.000000, 0.000488, 0.000488 }
  , { 224.000000, 0.000000, 0.109863, 0.000488 }
  , { 224.000000, 140.000000, 0.109863, 0.068848 }
  , { 0.000000, 140.000000, 0.000488, 0.068848 }
  }
, {
    { 1.000000, 0.000000, 0.219727, 0.000488 }
  , { 224.000000, 0.000000, 0.328613, 0.000488 }
  , { 224.000000, 140.000000, 0.328613, 0.068848 }
  , { 1.000000, 140.000000, 0.219727, 0.068848 }
  }
, {
    { 2.000000, 0.000000, 0.437988, 0.000488 }
  , { 224.000000, 0.000000, 0.546387, 0.000488 }
  , { 224.000000, 140.000000, 0.546387, 0.068848 }
  , { 2.000000, 140.000000, 0.437988, 0.068848 }
  }
, {
    { 3.000000, 0.000000, 0.654785, 0.000488 }
  , { 223.000000, 0.000000, 0.762207, 0.000488 }
  , { 223.000000, 140.000000, 0.762207, 0.068848 }
  , { 3.000000, 140.000000, 0.654785, 0.068848 }
  }
, {
    { 5.000000, 0.000000, 0.870117, 0.000488 }
  , { 222.000000, 0.000000, 0.976074, 0.000488 }
  , { 222.000000, 141.000000, 0.976074, 0.069336 }
  , { 5.000000, 141.000000, 0.870117, 0.069336 }
  }
, {
    { 7.000000, 0.000000, 0.106445, 0.069336 }
  , { 221.000000, 0.000000, 0.210938, 0.069336 }
  , { 221.000000, 141.000000, 0.210938, 0.138184 }
  , { 7.000000, 141.000000, 0.106445, 0.138184 }
  }
, {
    { 9.000000, 0.000000, 0.315918, 0.069336 }
  , { 220.000000, 0.000000, 0.418945, 0.069336 }
  , { 220.000000, 141.000000, 0.418945, 0.138184 }
  , { 9.000000, 141.000000, 0.315918, 0.138184 }
  }
, {
    { 12.000000, 0.000000, 0.521484, 0.069336 }
  , { 219.000000, 0.000000, 0.622559, 0.069336 }
  , { 219.000000, 141.000000, 0.622559, 0.138184 }
  , { 12.000000, 141.000000, 0.521484, 0.138184 }
  }
, {
    { 15.000000, 0.000000, 0.722656, 0.069336 }
  , { 217.000000, 0.000000, 0.821289, 0.069336 }
  , { 217.000000, 141.000000, 0.821289, 0.138184 }
  , { 15.000000, 141.000000, 0.722656, 0.138184 }
  }
, {
    { 19.000000, 0.000000, 0.000488, 0.138672 }
  , { 215.000000, 0.000000, 0.096191, 0.138672 }
  , { 215.000000, 141.000000, 0.096191, 0.207520 }
  , { 19.000000, 141.000000, 0.000488, 0.207520 }
  }
, {
    { 23.000000, 0.000000, 0.190430, 0.138672 }
  , { 213.000000, 0.000000, 0.283203, 0.138672 }
  , { 213.000000, 141.000000, 0.283203, 0.207520 }
  , { 23.000000, 141.000000, 0.190430, 0.207520 }
  }
, {
    { 27.000000, 0.000000, 0.550781, 0.213867 }
  , { 210.000000, 0.000000, 0.640137, 0.213867 }
  , { 210.000000, 142.000000, 0.640137, 0.283203 }
  , { 27.000000, 142.000000, 0.550781, 0.283203 }
  }
, {
    { 32.000000, 0.000000, 0.913574, 0.140137 }
  , { 208.000000, 0.000000, 0.999512, 0.140137 }
  , { 208.000000, 142.000000, 0.999512, 0.209473 }
  , { 32.000000, 142.000000, 0.913574, 0.209473 }
  }
, {
    { 36.000000, 0.000000, 0.874023, 0.584961 }
  , { 205.000000, 0.000000, 0.956543, 0.584961 }
  , { 205.000000, 142.000000, 0.956543, 0.654297 }
  , { 36.000000, 142.000000, 0.874023, 0.654297 }
  }
, {
    { 36.000000, 0.000000, 0.918945, 0.069824 }
  , { 202.000000, 0.000000, 1.000000, 0.069824 }
  , { 202.000000, 143.000000, 1.000000, 0.139648 }
  , { 36.000000, 143.000000, 0.918945, 0.139648 }
  }
, {
    { 35.000000, 0.000000, 0.245117, 0.434570 }
  , { 199.000000, 0.000000, 0.325195, 0.434570 }
  , { 199.000000, 143.000000, 0.325195, 0.504395 }
  , { 35.000000, 143.000000, 0.245117, 0.504395 }
  }
, {
    { 35.000000, 0.000000, 0.484863, 0.510254 }
  , { 196.000000, 0.000000, 0.563477, 0.510254 }
  , { 196.000000, 143.000000, 0.563477, 0.580078 }
  , { 35.000000, 143.000000, 0.484863, 0.580078 }
  }
, {
    { 35.000000, 0.000000, 0.743652, 0.209473 }
  , { 193.000000, 0.000000, 0.820801, 0.209473 }
  , { 193.000000, 144.000000, 0.820801, 0.279785 }
  , { 35.000000, 144.000000, 0.743652, 0.279785 }
  }
, {
    { 35.000000, 0.000000, 0.860352, 0.654785 }
  , { 190.000000, 0.000000, 0.936035, 0.654785 }
  , { 190.000000, 144.000000, 0.936035, 0.725098 }
  , { 35.000000, 144.000000, 0.860352, 0.725098 }
  }
, {
    { 36.000000, 0.000000, 0.000488, 0.508789 }
  , { 186.000000, 0.000000, 0.073730, 0.508789 }
  , { 186.000000, 145.000000, 0.073730, 0.579590 }
  , { 36.000000, 145.000000, 0.000488, 0.579590 }
  }
, {
    { 36.000000, 0.000000, 0.228516, 0.504883 }
  , { 183.000000, 0.000000, 0.300293, 0.504883 }
  , { 183.000000, 145.000000, 0.300293, 0.575684 }
  , { 36.000000, 145.000000, 0.228516, 0.575684 }
  }
, {
    { 37.000000, 0.000000, 0.000488, 0.651367 }
  , { 179.000000, 0.000000, 0.069824, 0.651367 }
  , { 179.000000, 145.000000, 0.069824, 0.722168 }
  , { 37.000000, 145.000000, 0.000488, 0.722168 }
  }
, {
    { 37.000000, 0.000000, 0.932129, 0.728516 }
  , { 176.000000, 0.000000, 1.000000, 0.728516 }
  , { 176.000000, 146.000000, 1.000000, 0.799805 }
  , { 37.000000, 146.000000, 0.932129, 0.799805 }
  }
, {
    { 38.000000, 0.000000, 0.296387, 0.648926 }
  , { 172.000000, 0.000000, 0.361816, 0.648926 }
  , { 172.000000, 146.000000, 0.361816, 0.720215 }
  , { 38.000000, 146.000000, 0.296387, 0.720215 }
  }
, {
    { 40.000000, 0.000000, 0.569336, 0.590820 }
  , { 172.000000, 0.000000, 0.633789, 0.590820 }
  , { 172.000000, 147.000000, 0.633789, 0.662598 }
  , { 40.000000, 147.000000, 0.569336, 0.662598 }
  }
, {
    { 41.000000, 0.000000, 0.428711, 0.654785 }
  , { 172.000000, 0.000000, 0.492676, 0.654785 }
  , { 172.000000, 147.000000, 0.492676, 0.726562 }
  , { 41.000000, 147.000000, 0.428711, 0.726562 }
  }
, {
    { 42.000000, 0.000000, 0.642578, 0.588379 }
  , { 172.000000, 0.000000, 0.706055, 0.588379 }
  , { 172.000000, 147.000000, 0.706055, 0.660156 }
  , { 42.000000, 147.000000, 0.642578, 0.660156 }
  }
, {
    { 43.000000, 0.000000, 0.556641, 0.663086 }
  , { 172.000000, 0.000000, 0.619629, 0.663086 }
  , { 172.000000, 148.000000, 0.619629, 0.735352 }
  , { 43.000000, 148.000000, 0.556641, 0.735352 }
  }
, {
    { 43.000000, 0.000000, 0.489258, 0.735352 }
  , { 172.000000, 0.000000, 0.552246, 0.735352 }
  , { 172.000000, 148.000000, 0.552246, 0.807617 }
  , { 43.000000, 148.000000, 0.489258, 0.807617 }
  }
, {
    { 44.000000, 0.000000, 0.620117, 0.732910 }
  , { 172.000000, 0.000000, 0.682617, 0.732910 }
  , { 172.000000, 149.000000, 0.682617, 0.805664 }
  , { 44.000000, 149.000000, 0.620117, 0.805664 }
  }
, {
    { 45.000000, 0.000000, 0.683105, 0.798340 }
  , { 172.000000, 0.000000, 0.745117, 0.798340 }
  , { 172.000000, 149.000000, 0.745117, 0.871094 }
  , { 45.000000, 149.000000, 0.683105, 0.871094 }
  }
, {
    { 46.000000, 0.000000, 0.615234, 0.806152 }
  , { 172.000000, 0.000000, 0.676758, 0.806152 }
  , { 172.000000, 150.000000, 0.676758, 0.879395 }
  , { 46.000000, 150.000000, 0.615234, 0.879395 }
  }
, {
    { 47.000000, 0.000000, 0.936523, 0.654785 }
  , { 177.000000, 0.000000, 1.000000, 0.654785 }
  , { 177.000000, 150.000000, 1.000000, 0.728027 }
  , { 47.000000, 150.000000, 0.936523, 0.728027 }
  }
, {
    { 48.000000, 0.000000, 0.437500, 0.580566 }
  , { 183.000000, 0.000000, 0.503418, 0.580566 }
  , { 183.000000, 151.000000, 0.503418, 0.654297 }
  , { 48.000000, 151.000000, 0.437500, 0.654297 }
  }
, {
    { 48.000000, 1.000000, 0.227539, 0.576172 }
  , { 188.000000, 1.000000, 0.295898, 0.576172 }
  , { 188.000000, 151.000000, 0.295898, 0.649414 }
  , { 48.000000, 151.000000, 0.227539, 0.649414 }
  }
, {
    { 47.000000, 1.000000, 0.155762, 0.575684 }
  , { 193.000000, 1.000000, 0.227051, 0.575684 }
  , { 193.000000, 152.000000, 0.227051, 0.649414 }
  , { 47.000000, 152.000000, 0.155762, 0.649414 }
  }
, {
    { 46.000000, 1.000000, 0.857422, 0.725586 }
  , { 198.000000, 1.000000, 0.931641, 0.725586 }
  , { 198.000000, 152.000000, 0.931641, 0.799316 }
  , { 46.000000, 152.000000, 0.857422, 0.799316 }
  }
, {
    { 45.000000, 1.000000, 0.706543, 0.576660 }
  , { 202.000000, 1.000000, 0.783203, 0.576660 }
  , { 202.000000, 152.000000, 0.783203, 0.650391 }
  , { 45.000000, 152.000000, 0.706543, 0.650391 }
  }
, {
    { 44.000000, 1.000000, 0.405273, 0.439453 }
  , { 206.000000, 1.000000, 0.484375, 0.439453 }
  , { 206.000000, 153.000000, 0.484375, 0.513672 }
  , { 44.000000, 153.000000, 0.405273, 0.513672 }
  }
, {
    { 44.000000, 1.000000, 0.083008, 0.429688 }
  , { 210.000000, 1.000000, 0.164062, 0.429688 }
  , { 210.000000, 153.000000, 0.164062, 0.503906 }
  , { 44.000000, 153.000000, 0.083008, 0.503906 }
  }
, {
    { 43.000000, 1.000000, 0.790527, 0.516602 }
  , { 213.000000, 1.000000, 0.873535, 0.516602 }
  , { 213.000000, 153.000000, 0.873535, 0.590820 }
  , { 43.000000, 153.000000, 0.790527, 0.590820 }
  }
, {
    { 43.000000, 1.000000, 0.622070, 0.440918 }
  , { 215.000000, 1.000000, 0.706055, 0.440918 }
  , { 215.000000, 154.000000, 0.706055, 0.515625 }
  , { 43.000000, 154.000000, 0.622070, 0.515625 }
  }
, {
    { 42.000000, 2.000000, 0.913574, 0.209961 }
  , { 218.000000, 2.000000, 0.999512, 0.209961 }
  , { 218.000000, 154.000000, 0.999512, 0.284180 }
  , { 42.000000, 154.000000, 0.913574, 0.284180 }
  }
, {
    { 41.000000, 2.000000, 0.904297, 0.510254 }
  , { 220.000000, 2.000000, 0.991699, 0.510254 }
  , { 220.000000, 154.000000, 0.991699, 0.584473 }
  , { 41.000000, 154.000000, 0.904297, 0.584473 }
  }
, {
    { 40.000000, 2.000000, 0.908691, 0.359375 }
  , { 221.000000, 2.000000, 0.997070, 0.359375 }
  , { 221.000000, 155.000000, 0.997070, 0.434082 }
  , { 40.000000, 155.000000, 0.908691, 0.434082 }
  }
, {
    { 39.000000, 2.000000, 0.640625, 0.214355 }
  , { 222.000000, 2.000000, 0.729980, 0.214355 }
  , { 222.000000, 155.000000, 0.729980, 0.289062 }
  , { 39.000000, 155.000000, 0.640625, 0.289062 }
  }
, {
    { 38.000000, 2.000000, 0.459961, 0.213867 }
  , { 223.000000, 2.000000, 0.550293, 0.213867 }
  , { 223.000000, 155.000000, 0.550293, 0.288574 }
  , { 38.000000, 155.000000, 0.459961, 0.288574 }
  }
, {
    { 37.000000, 2.000000, 0.821289, 0.214355 }
  , { 224.000000, 2.000000, 0.912598, 0.214355 }
  , { 224.000000, 155.000000, 0.912598, 0.289062 }
  , { 37.000000, 155.000000, 0.821289, 0.289062 }
  }
, {
    { 36.000000, 2.000000, 0.092773, 0.208008 }
  , { 224.000000, 2.000000, 0.184570, 0.208008 }
  , { 224.000000, 156.000000, 0.184570, 0.283203 }
  , { 36.000000, 156.000000, 0.092773, 0.283203 }
  }
, {
    { 36.000000, 2.000000, 0.185059, 0.208008 }
  , { 224.000000, 2.000000, 0.276855, 0.208008 }
  , { 224.000000, 156.000000, 0.276855, 0.283203 }
  , { 36.000000, 156.000000, 0.185059, 0.283203 }
  }
, {
    { 35.000000, 3.000000, 0.375977, 0.138672 }
  , { 223.000000, 3.000000, 0.467773, 0.138672 }
  , { 223.000000, 156.000000, 0.467773, 0.213379 }
  , { 35.000000, 156.000000, 0.375977, 0.213379 }
  }
, {
    { 35.000000, 3.000000, 0.277344, 0.213867 }
  , { 222.000000, 3.000000, 0.368652, 0.213867 }
  , { 222.000000, 156.000000, 0.368652, 0.288574 }
  , { 35.000000, 156.000000, 0.277344, 0.288574 }
  }
, {
    { 35.000000, 3.000000, 0.091797, 0.283691 }
  , { 221.000000, 3.000000, 0.182617, 0.283691 }
  , { 221.000000, 157.000000, 0.182617, 0.358887 }
  , { 35.000000, 157.000000, 0.091797, 0.358887 }
  }
, {
    { 35.000000, 3.000000, 0.369141, 0.283691 }
  , { 220.000000, 3.000000, 0.459473, 0.283691 }
  , { 220.000000, 157.000000, 0.459473, 0.358887 }
  , { 35.000000, 157.000000, 0.369141, 0.358887 }
  }
, {
    { 36.000000, 3.000000, 0.550781, 0.283691 }
  , { 219.000000, 3.000000, 0.640137, 0.283691 }
  , { 219.000000, 157.000000, 0.640137, 0.358887 }
  , { 36.000000, 157.000000, 0.550781, 0.358887 }
  }
, {
    { 36.000000, 3.000000, 0.818848, 0.365234 }
  , { 217.000000, 3.000000, 0.907227, 0.365234 }
  , { 217.000000, 157.000000, 0.907227, 0.440430 }
  , { 36.000000, 157.000000, 0.818848, 0.440430 }
  }
, {
    { 35.000000, 3.000000, 0.363770, 0.359375 }
  , { 215.000000, 3.000000, 0.451660, 0.359375 }
  , { 215.000000, 157.000000, 0.451660, 0.434570 }
  , { 35.000000, 157.000000, 0.363770, 0.434570 }
  }
, {
    { 32.000000, 3.000000, 0.638184, 0.365234 }
  , { 213.000000, 3.000000, 0.726562, 0.365234 }
  , { 213.000000, 157.000000, 0.726562, 0.440430 }
  , { 32.000000, 157.000000, 0.638184, 0.440430 }
  }
, {
    { 29.000000, 3.000000, 0.727051, 0.431152 }
  , { 210.000000, 3.000000, 0.815430, 0.431152 }
  , { 210.000000, 157.000000, 0.815430, 0.506348 }
  , { 29.000000, 157.000000, 0.727051, 0.506348 }
  }
} ;
static uint32_t const frames_count = array_count(frames) ;
//static_require(60 == frames_count, "upsi") ;


// 1433.000000, 586.000000, 0.699707, 0.572266
// 1655.000000, 586.000000, 0.808105, 0.572266
// 1655.000000, 726.000000, 0.808105, 0.708984
// 1433.000000, 726.000000, 0.699707, 0.708984


static float const spw = 256.0f ;
static float const sph = 256.0f ;
static float const half_spw = spw / 2.0f ;
static float const half_sph = sph / 2.0f ;

// static float const p0x = 1.0f ;
// static float const p0y = 1.0f ;
// static float const p1x = 183.0f ;
// static float const p1y = 1.0f ;
// static float const p2x = 183.0f ;
// static float const p2y = 155.0f ;
// static float const p3x = 1.0f ;
// static float const p3y = 155.0f ;

static float const p0x = 0.0f ;
static float const p0y = 0.0f ;
static float const p1x = 0.0f ;
static float const p1y = 0.0f ;
static float const p2x = 0.0f ;
static float const p2y = 0.0f ;
static float const p3x = 0.0f ;
static float const p3y = 0.0f ;


static float const ttw = 1.0f ;
static float const tth = 1.0f ;

// static float const t0u = 0.000488f ;
// static float const t0v = 0.000977f ;
// static float const t1u = 0.089355f ;
// static float const t1v = 0.000977f ;
// static float const t2u = 0.089355f ;
// static float const t2v = 0.151367f ;
// static float const t3u = 0.000488f ;
// static float const t3v = 0.151367f ;

static float const t0u = 0.0f ;
static float const t0v = 0.0f ;
static float const t1u = 0.0f ;
static float const t1v = 0.0f ;
static float const t2u = 0.0f ;
static float const t2v = 0.0f ;
static float const t3u = 0.0f ;
static float const t3v = 0.0f ;


static vertex const vertices[] =
{
    { {p0x, p0y}, {t0u, t0v} }
,   { {p1x, p1y}, {t1u, t1v} }
,   { {p2x, p2y}, {t2u, t2v} }
,   { {p3x, p3y}, {t3u, t3v} }
} ;
static uint32_t const vertices_size = sizeof(vertices) ;
//static uint32_t const vertices_count = array_count(vertices) ;


static uint16_t const indices[] =
{
    0, 1, 2
,   2, 3, 0
} ;
static uint32_t const   indices_size = sizeof(indices) ;
static uint32_t const   indices_count = array_count(indices) ;


#define max_ubo_instance_count  64

static uint32_t animation_frame_counters[max_ubo_instance_count] = { 0 } ;

typedef struct uniform_buffer_object
{
    vec2 offset_ ;
    vec2 scale_ ;
    vec4 pos_[max_ubo_instance_count][4] ;
    vec4 ori_[max_ubo_instance_count] ;

} uniform_buffer_object ;


static uint32_t const uniform_buffer_object_size = sizeof(uniform_buffer_object) ;


static uniform_buffer_object ubos[max_vulkan_frames_in_flight] = { 0 } ;



static void
update_uniform_buffer(
    vulkan_context *    vc
,   vulkan_rob *        vr
,   uint32_t const      current_frame
)
{
    require(vc) ;
    require(current_frame < max_vulkan_frames_in_flight) ;
    require(current_frame < vc->frames_in_flight_count_) ;
    require(vr) ;
    require(120 == frames_count) ;

    static bool once = true ;
    static uint64_t previous_time = 0 ;

    uint64_t const current_time = get_app_time() ;

    if(once)
    {
        once = false ;
        previous_time = current_time ;

        uint32_t sf = 0 ;
        for(
            uint32_t i = 0
        ;   i < max_ubo_instance_count
        ;   ++i
        )
        {
            animation_frame_counters[i] = sf % frames_count ;
            sf += 6 ;
        }
    }

    uint64_t const delta_time = (current_time - previous_time) / 2 ;
    double const fractional_seconds = (double) delta_time * get_performance_frequency_inverse() ;

    float const ox = app_->half_window_width_float_ - half_spw ;
    float const oy = app_->half_window_height_float_ - half_sph ;
    float const oxr = 6.0f * half_spw * sinf(fractional_seconds * 0.5f) ;
    float const oyr = 4.0f * half_sph * sinf(fractional_seconds * 0.5f) ;

    uniform_buffer_object * ubo = &ubos[current_frame] ;

    ubo->offset_[0] = app_->half_window_width_float_ ;
    ubo->offset_[1] = app_->half_window_height_float_ ;
    ubo->scale_[0]  = app_->inverse_half_window_width_float_ ;
    ubo->scale_[1]  = app_->inverse_half_window_height_float_ ;

    float angle = fractional_seconds ;
    float angle_inc = 2.0f * M_PI / max_ubo_instance_count ;

    for(
        uint32_t i = 0
    ;   i < max_ubo_instance_count
    ;   ++i
    )
    {
        uint32_t fc = animation_frame_counters[i] % frames_count ;
        ++animation_frame_counters[i] ;

        float const px = ox + oxr * sinf(angle) ;
        float const py = oy + oyr * cosf(angle) ;

        //ubo->pos_[i][0]    = ox + oxr * sinf(angle) ;
        //ubo->pos_[i][1]    = oy + oyr * cosf(angle) ;
        SDL_memcpy(&ubo->pos_[i], &frames[fc], sizeof(mat4)) ;
        ubo->ori_[i][0] = px ;
        ubo->ori_[i][1] = py ;
        ubo->ori_[i][2] = 0 ;
        ubo->ori_[i][3] = 0 ;

        // ubo->pos_[i][0][0]    = 0 ;
        // ubo->pos_[i][0][1]    = 0 ;
        // ubo->pos_[i][0][2]    = 0 ;
        // ubo->pos_[i][0][3]    = 0 ;
        angle += angle_inc ;
    }

    SDL_memcpy(vr->uniform_buffers_mapped_[current_frame], ubo, uniform_buffer_object_size) ;
}


static bool
record_command_buffer(
    vulkan_context *    vc
,   vulkan_rob *        vr
,   VkCommandBuffer     command_buffer
,   VkDescriptorSet     descriptor_set
)
{
    require(vc) ;
    require(vr) ;
    require(command_buffer) ;
    require(descriptor_set) ;

    begin_timed_block() ;

    // void vkCmdBindPipeline(
    //     VkCommandBuffer                             commandBuffer,
    //     VkPipelineBindPoint                         pipelineBindPoint,
    //     VkPipeline                                  pipeline);
    vkCmdBindPipeline(
        command_buffer
    ,   VK_PIPELINE_BIND_POINT_GRAPHICS
    ,   vr->graphics_pipeline_
    ) ;


    VkBuffer vertex_buffers[] = { vr->vertex_buffer_} ;
    VkDeviceSize offsets[] = { 0 } ;

    // void vkCmdBindVertexBuffers(
    //     VkCommandBuffer                             commandBuffer,
    //     uint32_t                                    firstBinding,
    //     uint32_t                                    bindingCount,
    //     const VkBuffer*                             pBuffers,
    //     const VkDeviceSize*                         pOffsets);
    vkCmdBindVertexBuffers(command_buffer, 0, 1, vertex_buffers, offsets) ;


    // void vkCmdBindIndexBuffer(
    //     VkCommandBuffer                             commandBuffer,
    //     VkBuffer                                    buffer,
    //     VkDeviceSize                                offset,
    //     VkIndexType                                 indexType);
    vkCmdBindIndexBuffer(
        command_buffer
    ,   vr->index_buffer_
    ,   0
    ,   VK_INDEX_TYPE_UINT16
    ) ;

    // void vkCmdBindDescriptorSets(
    //     VkCommandBuffer                             commandBuffer,
    //     VkPipelineBindPoint                         pipelineBindPoint,
    //     VkPipelineLayout                            layout,
    //     uint32_t                                    firstSet,
    //     uint32_t                                    descriptorSetCount,
    //     const VkDescriptorSet*                      pDescriptorSets,
    //     uint32_t                                    dynamicOffsetCount,
    //     const uint32_t*                             pDynamicOffsets);
    vkCmdBindDescriptorSets(
        command_buffer
    ,   VK_PIPELINE_BIND_POINT_GRAPHICS
    ,   vr->pipeline_layout_
    ,   0
    ,   1
    ,   &descriptor_set
    ,   0
    ,   NULL
    ) ;

    // void vkCmdDrawIndexed(
    //     VkCommandBuffer                             commandBuffer,
    //     uint32_t                                    indexCount,
    //     uint32_t                                    instanceCount,
    //     uint32_t                                    firstIndex,
    //     int32_t                                     vertexOffset,
    //     uint32_t                                    firstInstance);
    vkCmdDrawIndexed(command_buffer, indices_count, max_ubo_instance_count, 0, 0, 0) ;

    end_timed_block() ;
    return true ;
}




static bool
update_rob(
    vulkan_context *    vc
,   void *              param
,   uint32_t const      current_frame
)
{
    require(vc) ;
    begin_timed_block() ;

    vulkan_rob *    vr = &the_vulkan_rob_ ;
    require(vr == param) ;

    update_uniform_buffer(vc, vr, current_frame) ;

    end_timed_block() ;
    return true ;
}


static bool
record_rob(
    vulkan_context *    vc
,   void *              param
,   uint32_t const      current_frame
)
{
    require(vc) ;
    begin_timed_block() ;
    vulkan_rob *    vr = &the_vulkan_rob_ ;
    require(vr == param) ;

    require(current_frame < vc->frames_in_flight_count_) ;

    if(check(record_command_buffer(
                vc
            ,   vr
            ,   vc->command_buffer_[current_frame]
            ,   vr->descriptor_sets_[current_frame]
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }

    end_timed_block() ;
    return true ;
}


static bool
draw_rob(
    vulkan_context *    vc
,   void *              param
,   uint32_t const      current_frame
)
{
    require(vc) ;
    begin_timed_block() ;
    vulkan_rob *    vr = &the_vulkan_rob_ ;
    require(vr == param) ;
    require(current_frame < vc->frames_in_flight_count_) ;

    if(vc->enable_pre_record_command_buffers_)
    {
        end_timed_block() ;
        return true ;
    }

    if(check(record_command_buffer(
                vc
            ,   vr
            ,   vc->command_buffer_[current_frame]
            ,   vr->descriptor_sets_[current_frame]
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }

    end_timed_block() ;
    return true ;
}


static bool
destroy_rob(
    vulkan_context *    vc
,   void *              param
)
{
    require(vc) ;
    begin_timed_block() ;

    vulkan_rob *    vr = &the_vulkan_rob_ ;
    require(vr == param) ;

    if(vr->texture_sampler_)
    {
        // void vkDestroySampler(
        //     VkDevice                                    device,
        //     VkSampler                                   sampler,
        //     const VkAllocationCallbacks*                pAllocator);
        vkDestroySampler(vc->device_, vr->texture_sampler_, NULL) ;
        vr->texture_sampler_ = NULL ;
    }

    if(vr->texture_image_view_)
    {
        vkDestroyImageView(vc->device_, vr->texture_image_view_, NULL) ;
        vr->texture_image_view_ = NULL ;
    }

    if(vr->texture_image_)
    {
        // void vkDestroyImage(
        // VkDevice                                    device,
        // VkImage                                     image,
        // const VkAllocationCallbacks*                pAllocator);
        vkDestroyImage(vc->device_, vr->texture_image_, NULL) ;
        vr->texture_image_ = NULL ;
    }

    if(vr->texture_image_memory_)
    {
        vkFreeMemory(vc->device_, vr->texture_image_memory_, NULL) ;
        vr->texture_image_memory_ = NULL ;
    }

    for(
        uint32_t i = 0
    ;   i < vc->frames_in_flight_count_
    ;   ++i
    )
    {
        vkDestroyBuffer(vc->device_, vr->uniform_buffers_[i], NULL) ;
        vr->uniform_buffers_[i] = NULL ;
        vkFreeMemory(vc->device_, vr->uniform_buffers_memory_[i], NULL) ;
        vr->uniform_buffers_memory_[i] = NULL ;
    }

    if(vr->descriptor_pool_)
    {
        // void vkDestroyDescriptorPool(
        //     VkDevice                                    device,
        //     VkDescriptorPool                            descriptorPool,
        //     const VkAllocationCallbacks*                pAllocator);
        vkDestroyDescriptorPool(vc->device_, vr->descriptor_pool_, NULL) ;
        vr->descriptor_pool_ = NULL ;
    }


    if(vr->descriptor_set_layout_)
    {
        // void vkDestroyDescriptorSetLayout(
        //     VkDevice                                    device,
        //     VkDescriptorSetLayout                       descriptorSetLayout,
        //     const VkAllocationCallbacks*                pAllocator);
        vkDestroyDescriptorSetLayout(vc->device_, vr->descriptor_set_layout_, NULL) ;
        vr->descriptor_set_layout_ = NULL ;
    }


    if(vr->index_buffer_)
    {
        vkDestroyBuffer(vc->device_, vr->index_buffer_, NULL) ;
        vr->index_buffer_ = NULL ;
    }

    if(vr->index_buffer_memory_)
    {
        vkFreeMemory(vc->device_, vr->index_buffer_memory_, NULL) ;
        vr->index_buffer_memory_ = NULL ;
    }


    if(vr->vertex_buffer_)
    {
        // void vkDestroyBuffer(
        //     VkDevice                                    device,
        //     VkBuffer                                    buffer,
        //     const VkAllocationCallbacks*                pAllocator);
        vkDestroyBuffer(vc->device_, vr->vertex_buffer_, NULL) ;
        vr->vertex_buffer_ = NULL ;
    }

    if(vr->vertex_buffer_memory_)
    {
        // void vkFreeMemory(
        //     VkDevice                                    device,
        //     VkDeviceMemory                              memory,
        //     const VkAllocationCallbacks*                pAllocator);
        //     }
        vkFreeMemory(vc->device_, vr->vertex_buffer_memory_, NULL) ;
        vr->vertex_buffer_memory_ = NULL ;
    }

    if(vr->graphics_pipeline_)
    {
        // void vkDestroyPipeline(
        //     VkDevice                                    device,
        //     VkPipeline                                  pipeline,
        //     const VkAllocationCallbacks*                pAllocator);
        vkDestroyPipeline(vc->device_, vr->graphics_pipeline_, NULL) ;
        vr->graphics_pipeline_ = NULL ;
    }

    if(vr->pipeline_layout_)
    {
        // void vkDestroyPipelineLayout(
        //     VkDevice                                    device,
        //     VkPipelineLayout                            pipelineLayout,
        //     const VkAllocationCallbacks*                pAllocator);
        vkDestroyPipelineLayout(vc->device_, vr->pipeline_layout_, NULL) ;
        vr->pipeline_layout_ = NULL ;
    }

    end_timed_block() ;
    return true ;
}


static bool
create_rob(
    vulkan_context *    vc
,   void *              param
)
{
    require(vc) ;
    begin_timed_block() ;

    vulkan_rob *    vr = &the_vulkan_rob_ ;
    require(vr == param) ;

    // 1 == means no mip maps
    // 0 == auto mipmap generation
    vr->texture_mip_levels_         = 1 ;
    vr->texture_enable_anisotropy_  = VK_TRUE ;
    vr->texture_anisotropy_         = 1.0f ;

    // allow mipmapping when optimal tiling support is available
    if(
        vc->picked_physical_device_->swapchain_support_details_.formats_properties_->optimalTilingFeatures & VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT)
    {
        vr->texture_mip_levels_ = 0 ;
    }

    require(vr->texture_anisotropy_ <= vc->picked_physical_device_->properties_.limits.maxSamplerAnisotropy) ;

    add_desriptor_set_layout_binding(
        vr->descriptor_set_layout_bindings_
    ,   &vr->descriptor_set_layout_bindings_count_
    ,   max_vulkan_descriptor_set_layout_binding
    ,   0
    ,   VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER
    ,   VK_SHADER_STAGE_VERTEX_BIT
    ) ;

    add_desriptor_set_layout_binding(
        vr->descriptor_set_layout_bindings_
    ,   &vr->descriptor_set_layout_bindings_count_
    ,   max_vulkan_descriptor_set_layout_binding
    ,   1
    ,   VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER
    ,   VK_SHADER_STAGE_FRAGMENT_BIT
    ) ;

    if(check(create_descriptor_set_layout(
                &vr->descriptor_set_layout_
            ,   vc->device_
            ,   vr->descriptor_set_layout_bindings_
            ,   vr->descriptor_set_layout_bindings_count_
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }

    fill_pipeline_layout_create_info(
        &vr->pipeline_layout_create_info_
    ,   &vr->descriptor_set_layout_
    ,   1
    ) ;

    if(check_vulkan(vkCreatePipelineLayout(
                vc->device_
            ,   &vr->pipeline_layout_create_info_
            ,   NULL
            ,   &vr->pipeline_layout_
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }
    require(vr->pipeline_layout_) ;

    require(0 == vr->descriptor_pool_sizes_count_) ;
    add_descriptor_pool_size(
        vr->descriptor_pool_sizes_
    ,   &vr->descriptor_pool_sizes_count_
    ,   max_vulkan_descriptor_pool_size
    ,   VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER
    ,   vc->frames_in_flight_count_
    ) ;
    require(1 == vr->descriptor_pool_sizes_count_) ;

    add_descriptor_pool_size(
        vr->descriptor_pool_sizes_
    ,   &vr->descriptor_pool_sizes_count_
    ,   max_vulkan_descriptor_pool_size
    ,   VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER
    ,   vc->frames_in_flight_count_
    ) ;

    if(check(create_descriptor_pool(
                &vr->descriptor_pool_
            ,   vc->device_
            ,   vr->descriptor_pool_sizes_
            ,   vr->descriptor_pool_sizes_count_
            ,   vc->frames_in_flight_count_
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }
    require(vr->descriptor_pool_) ;

    if(check(create_descriptor_sets(
                vr->descriptor_sets_
            ,   vc->device_
            ,   vr->descriptor_set_layout_
            ,   vr->descriptor_pool_
            ,   vc->frames_in_flight_count_
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }
    require(vr->descriptor_sets_) ;

    if(check(create_uniform_buffers(
                vr->uniform_buffers_
            ,   vr->uniform_buffers_memory_
            ,   vr->uniform_buffers_mapped_
            ,   vc->device_
            ,   uniform_buffer_object_size
            ,   &vc->picked_physical_device_->memory_properties_
            ,   vc->frames_in_flight_count_
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }

    if(check(create_texture_image(
                &vr->texture_image_
            ,   &vr->texture_image_memory_
            ,   &vr->texture_mip_levels_
            ,   "ass/textures/test.png"
            ,   vc->device_
            ,   vc->command_pool_
            ,   vc->graphics_queue_
            ,   &vc->picked_physical_device_->memory_properties_
            ,   vr->texture_mip_levels_
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }

    if(check(create_texture_image_view(
                &vr->texture_image_view_
            ,   vc->device_
            ,   vr->texture_image_
            ,   vr->texture_mip_levels_
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }

    if(check(create_texture_sampler(
                &vr->texture_sampler_
            ,   vc->device_
            ,   vr->texture_mip_levels_
            ,   vr->texture_enable_anisotropy_
            ,   vr->texture_anisotropy_
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }

    add_descriptor_buffer_info(
        vr->descriptor_buffer_infos_
    ,   &vr->descriptor_buffer_infos_count_
    ,   max_vulkan_descriptor_buffer_infos
    ,   vc->frames_in_flight_count_
    ,   vr->uniform_buffers_
    ,   0
    ,   uniform_buffer_object_size
    ) ;

    add_descriptor_image_info(
        vr->descriptor_image_infos_
    ,   &vr->descriptor_image_infos_count_
    ,   max_vulkan_descriptor_image_infos
    ,   vc->frames_in_flight_count_
    ,   vr->texture_image_view_
    ,   vr->texture_sampler_
    ) ;

    add_write_descriptor_buffer_set(
        vr->write_descriptor_sets_
    ,   &vr->write_descriptor_sets_count_
    ,   max_vulkan_write_descriptor_sets
    ,   vr->descriptor_sets_
    ,   vc->frames_in_flight_count_
    ,   vr->descriptor_buffer_infos_
    ,   vr->descriptor_buffer_infos_count_
    ,   max_vulkan_descriptor_buffer_infos
    ,   vc->frames_in_flight_count_
    ,   0
    ,   0
    ,   VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER
    ) ;

    add_write_descriptor_image_set(
        vr->write_descriptor_sets_
    ,   &vr->write_descriptor_sets_count_
    ,   max_vulkan_write_descriptor_sets
    ,   vr->descriptor_sets_
    ,   vc->frames_in_flight_count_
    ,   vr->descriptor_image_infos_
    ,   vr->descriptor_image_infos_count_
    ,   max_vulkan_descriptor_image_infos
    ,   vc->frames_in_flight_count_
    ,   0
    ,   1
    ,   VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER
    ) ;

    update_descriptor_sets(
        vr->write_descriptor_sets_
    ,   vr->write_descriptor_sets_count_
    ,   max_vulkan_write_descriptor_sets
    ,   vc->device_
    ,   vc->frames_in_flight_count_
    ) ;

    if(check(create_vertex_buffer(
                &vr->vertex_buffer_
            ,   &vr->vertex_buffer_memory_
            ,   vc->device_
            ,   vc->command_pool_
            ,   vc->graphics_queue_
            ,   &vc->picked_physical_device_->memory_properties_
            ,   vertices
            ,   vertices_size
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }
    require(vr->vertex_buffer_) ;
    require(vr->vertex_buffer_memory_) ;

    if(check(create_index_buffer(
                &vr->index_buffer_
            ,   &vr->index_buffer_memory_
            ,   vc->device_
            ,   vc->command_pool_
            ,   vc->graphics_queue_
            ,   &vc->picked_physical_device_->memory_properties_
            ,   indices
            ,   indices_size
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }
    require(vr->index_buffer_) ;
    require(vr->index_buffer_memory_) ;

    if(check(load_shader_file(
                &vr->vert_shader_
            ,   vc->device_
            ,   "ass/shaders/sprite_animation_shader.vert.spv"
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }
    require(vr->vert_shader_) ;

    if(check(load_shader_file(
                &vr->frag_shader_
            ,   vc->device_
            ,   "ass/shaders/sprite_animation_shader.frag.spv"
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }
    require(vr->frag_shader_) ;

    add_pipeline_shader_stage_create_info(
        vr->pipeline_shader_stage_create_infos_
    ,   &vr->pipeline_shader_stage_create_infos_count_
    ,   max_vulkan_pipeline_shader_stage_create_infos
    ,   vr->vert_shader_
    ,   VK_SHADER_STAGE_VERTEX_BIT
    ) ;

    add_pipeline_shader_stage_create_info(
        vr->pipeline_shader_stage_create_infos_
    ,   &vr->pipeline_shader_stage_create_infos_count_
    ,   max_vulkan_pipeline_shader_stage_create_infos
    ,   vr->frag_shader_
    ,   VK_SHADER_STAGE_FRAGMENT_BIT
    ) ;

    fill_vertex_input_binding_description(
        &vr->vertex_input_binding_description_
    ,   0
    ,   vertex_size
    ) ;

    add_vertex_input_attribute_description(
        vr->vertex_input_attribute_descriptions_
    ,   &vr->vertex_input_attribute_descriptions_count_
    ,   max_vulkan_vertex_input_attribute_descriptions
    ,   0
    ,   0
    ,   VK_FORMAT_R32G32_SFLOAT
    ,   offsetof(vertex, pos)
    ) ;

    add_vertex_input_attribute_description(
        vr->vertex_input_attribute_descriptions_
    ,   &vr->vertex_input_attribute_descriptions_count_
    ,   max_vulkan_vertex_input_attribute_descriptions
    ,   1
    ,   0
    ,   VK_FORMAT_R32G32_SFLOAT
    ,   offsetof(vertex, uv)
    ) ;

    // add_vertex_input_attribute_description(
    //     vr->vertex_input_attribute_descriptions_
    // ,   &vr->vertex_input_attribute_descriptions_count_
    // ,   max_vulkan_vertex_input_attribute_descriptions
    // ,   2
    // ,   0
    // ,   VK_FORMAT_R32G32B32_SFLOAT
    // ,   offsetof(vertex, color)
    // ) ;

    fill_pipeline_vertex_input_state_create_info(
        &vr->pipeline_vertex_input_state_create_info_
    ,   &vr->vertex_input_binding_description_
    ,   vr->vertex_input_attribute_descriptions_
    ,   vr->vertex_input_attribute_descriptions_count_
    ) ;

    fill_pipeline_input_assembly_state_create_info(
        &vr->pipeline_input_assembly_state_create_info_
    ,   VK_PRIMITIVE_TOPOLOGY_TRIANGLE_LIST
    ,   VK_FALSE
    ) ;

    fill_viewport(
        &vr->viewport_
    ,   0
    ,   0
    ,   vc->swapchain_extent_.width
    ,   vc->swapchain_extent_.height
    ,   0
    ,   1
    ) ;

    fill_scissor(
        &vr->scissor_
    ,   0
    ,   0
    ,   vc->swapchain_extent_.width
    ,   vc->swapchain_extent_.height
    ) ;


    fill_pipeline_viewport_state_create_info(
        &vr->pipeline_viewport_state_create_info_
    ,   &vr->viewport_
    ,   &vr->scissor_
    ) ;

    add_to_dynamic_state(
        vr->dynamic_states_
    ,   &vr->dynamic_states_count_
    ,   max_vulkan_dynamic_states
    ,   VK_DYNAMIC_STATE_VIEWPORT
    ) ;

    add_to_dynamic_state(
        vr->dynamic_states_
    ,   &vr->dynamic_states_count_
    ,   max_vulkan_dynamic_states
    ,   VK_DYNAMIC_STATE_SCISSOR
    ) ;

    fill_pipeline_dynamic_state_create_info(
        &vr->pipeline_dynamic_state_create_info_
    ,   vr->dynamic_states_
    ,   vr->dynamic_states_count_
    ) ;

    fill_pipeline_rasterization_state_create_info(
        &vr->pipeline_rasterization_state_create_info_
    ,   VK_POLYGON_MODE_FILL
    ,   VK_CULL_MODE_NONE
    ,   VK_FRONT_FACE_COUNTER_CLOCKWISE
    ) ;

    fill_pipeline_multisample_state_create_info(
        &vr->pipeline_multisample_state_create_info_
    ,   vc->enable_sampling_
    ,   vc->sample_count_
    ,   vc->enable_sample_shading_
    ,   vc->min_sample_shading_
    ) ;

    fill_pipeline_color_blend_attachment_state(
        &vr->pipeline_color_blend_attachment_state_
    ,   VK_FALSE
    ) ;

    fill_pipeline_color_blend_state_create_info(
        &vr->pipeline_color_blend_state_create_info_
    ,   VK_FALSE
    ,   VK_LOGIC_OP_COPY
    ,   &vr->pipeline_color_blend_attachment_state_
    ) ;

    fill_pipeline_depth_stencil_state_create_info(
        &vr->pipeline_depth_stencil_state_create_info_
    ,   VK_TRUE
    ,   VK_TRUE
    ,   VK_COMPARE_OP_LESS
    ) ;

    fill_graphics_pipeline_create_info(
        &vr->graphics_pipeline_create_info_
    ,   vr->pipeline_layout_
    ,   vc->render_pass_
    ,   vr->pipeline_shader_stage_create_infos_
    ,   vr->pipeline_shader_stage_create_infos_count_
    ,   &vr->pipeline_vertex_input_state_create_info_
    ,   &vr->pipeline_input_assembly_state_create_info_
    ,   &vr->pipeline_viewport_state_create_info_
    ,   &vr->pipeline_rasterization_state_create_info_
    ,   &vr->pipeline_multisample_state_create_info_
    ,   &vr->pipeline_depth_stencil_state_create_info_
    ,   &vr->pipeline_color_blend_state_create_info_
    ,   &vr->pipeline_dynamic_state_create_info_
    ) ;

    // VkResult vkCreateGraphicsPipelines(
    //     VkDevice                                    device,
    //     VkPipelineCache                             pipelineCache,
    //     uint32_t                                    createInfoCount,
    //     const VkGraphicsPipelineCreateInfo*         pCreateInfos,
    //     const VkAllocationCallbacks*                pAllocator,
    //     VkPipeline*                                 pPipelines);
    if(check_vulkan(vkCreateGraphicsPipelines(
                vc->device_
            ,   VK_NULL_HANDLE
            ,   1
            ,   &vr->graphics_pipeline_create_info_
            ,   NULL
            ,   &vr->graphics_pipeline_
            )
        )
    )
    {
        end_timed_block() ;
        return false ;
    }
    require(vr->graphics_pipeline_) ;

    vkDestroyShaderModule(vc->device_, vr->vert_shader_, NULL) ;
    vr->vert_shader_ = NULL ;
    vkDestroyShaderModule(vc->device_, vr->frag_shader_, NULL) ;
    vr->frag_shader_ = NULL ;

    end_timed_block() ;
    return true ;
}


void
make_rob_sprite_animation(
    vulkan_render_object *  out_rob
)
{
    require(out_rob) ;

    out_rob->create_func_   = create_rob ;
    out_rob->draw_func_     = draw_rob ;
    out_rob->update_func_   = update_rob ;
    out_rob->record_func_   = record_rob ;
    out_rob->destroy_func_  = destroy_rob ;
    out_rob->param_         = &the_vulkan_rob_ ;
    out_rob->vc_            = NULL ;
}

